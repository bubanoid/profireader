{% extends "_ruslan/_index_layout.html" %}
{% block title %}Profireader{% endblock title %}
{% block head %}
    {{ super() }}
    {% include '_ruslan/partials/_header_files_sortable.html' %}
    {% include '_ruslan/partials/_header_files_crop.html' %}
{% endblock head %}

{% block portal_content %}

    {% block company_base %}
        {% include 'company/company_base_angular.html' %}
    {% endblock company_base %}

    <script>
        module.controller('portal_create', ['$scope', '$uibModal', function ($scope, $uibModal) {
            angularControllerFunction('CompanyMenuController', 'set_selected_company_menu')('home');

            $scope.url_after_save = {{ raw_url_for('company.profile')|safe }};

            $scope.afterSave = function (resp) {
                window.location.href = $scope.url_after_save({company_id: resp.company_owner_id})
            };
            $scope.$$translate = {{ translates('portal_create')|safe }};

            $scope.addDivision = function () {
                $scope.data.portal.divisions.push({
                    name: '',
                    portal_division_type_id: 'news'
                });
                return false;
            };

            $scope.removeDivision = function (index) {
                $scope.data.portal.divisions.splice(index, 1);
            };

            $scope.sortableOptions = {
                stop: function (e, ui) {
                    if ($scope.data_validation.errors && $scope.data_validation.errors.remove_division) {
                        $scope.data_validation.errors.remove_division = []
                    }
                    if ($scope.data_validation.warnings && $scope.data_validation.warnings.remove_division) {
                        $scope.data_validation.warnings.remove_division = []
                    }
                    if ($scope.data_validation.errors && $scope.data_validation.errors.company_subportal) {
                        $scope.data_validation.errors.company_subportal = []
                    }
                    if ($scope.data_validation.warnings && $scope.data_validation.warnings.company_subportal) {
                        $scope.data_validation.warnings.company_subportal = []
                    }
                },
                'tolerance': 'pointer',
                containment: "parent",
                axis: "y",
                handle: ".fa-arrows-v"
            };

        }]);
    </script>
    {% raw %}

    <div class="controller-portal-edit" ng-controller="portal_create" ng-cloak>
        <form name="formPortal">
            <div class="container" af af-after-save="afterSave" af-watch="data.portal" ng-model="data">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h2>{{ ::_('Creating portal') }}</h2>
                        <hr/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 image-company-profile create-img">
                        <div>
                            <div style="width: 400px; height: 300px; position: relative;"
                                 pr-crop="data.portal.logo"></div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        <div class="narrow-wide">
                            <div>
                                <label>{{ ::_('Name') }}</label>

                                <input type="text" class="form-control border-radius" id="basic-url"
                                       aria-describedby="basic-addon3" pr-validation-answer="data_validation:name"
                                       ng-model="data.portal.name" name="portal_name">

                            </div>
                            <div>
                                <label><input ng-value="'profi'" ng-model="data.portal.host_profi_or_own"
                                              type="radio"/>&nbsp;{{ ::_('Profireader subdomain') }}</label><input
                                    ng-disabled="data.portal.host_profi_or_own !== 'profi'"
                                    class="form-control border-radius"
                                    pr-validation-disable="data.portal.host_profi_or_own !== 'profi'"
                                    pr-validation-answer="data_validation:host"
                                    ng-model="data.portal.host_profi"/>

                            </div>
                            <div>
                                <label><input ng-value="'own'" ng-model="data.portal.host_profi_or_own"
                                              type="radio"/>&nbsp;{{ ::_('Own domain') }}</label>

                                <input
                                        ng-style="data.portal.host_profi_or_own !== 'own'?{'border-color':'gray'}:{}"
                                        ng-disabled="data.portal.host_profi_or_own !== 'own'"
                                        pr-validation-disable="data.portal.host_profi_or_own !== 'own'"
                                        class="form-control border-radius"
                                        pr-validation-answer="data_validation:host"
                                        ng-model="data.portal.host_own"/>

                            </div>
                            <div>
                                <label>{{ ::_('Host') }}</label>
                                <a class="form-control border-none oh nowrap" target="_blank"
                                   ng-href="https://{{ data.portal.host_profi_or_own === 'own'?data.portal.host_own:(data.portal.host_profi + '.' + MAIN_DOMAIN) }}">https://{{
                                    data.portal.host_profi_or_own ===
                                    'own'?data.portal.host_own:(data.portal.host_profi + '.' + MAIN_DOMAIN) }}<span
                                            class="fa fa-external-link pr-external-link"></span></a>

                            </div>
                            <div>

                                <label>{{ _('Portal layout') }}</label>

                                <select class="form-control w20em" ng-model="data.portal.portal_layout_id"
                                        ng-options="layout.id as layout.name for layout in data.layouts"></select>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <hr/>
                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10"><h4>{{ _('Portal divisions') }}</h4></div>
                </div>
                {% endraw %}
                {#                <div class="row dn">#}
                {#                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input class="form-control " type="text"#}
                {#                                                                            placeholder=""#}
                {#                                                                            disabled="disabled"#}
                {#                                                                            value="{{ data.portal.name }}">#}
                {#                    </div>#}
                {#                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"><select#}
                {#                            class="form-control" disabled="disabled">#}
                {#                        <option>{{ ::_('index division')}}</option>#}
                {#                    </select>#}
                {#                    </div>#}
                {#                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">#}
                {#                        <button class="pull-right btn btn-warning disabled">{{ ::_('remove division') }}</button>#}
                {#                    </div>#}
                {#                </div>#}
                {% raw %}

                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 p025em">
                        <label class="form-control border-none pull-right">{{ ::_('Division name') }}</label>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 p025em">
                        <label class="form-control border-none pull-right w15em">{{ ::_('Division type') }}</label>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 p025em"></div>
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 p025em">
                        <button class="pull-right btn btn-success form-control" type="button"
                                popover-placement="left"
                                pr-validation-answer="data_validation:add_division"
                                ng-click="addDivision()"><i class="fa fa-plus"></i> {{ ::_('add division') }}
                        </button>
                    </div>

                </div>
                <div ui-sortable="sortableOptions" ng-model="data.portal.divisions">
                    <div class="row"

                         ng-repeat="(division_index, division) in data.portal.divisions">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 p025em tar">
                        <span style="cursor: row-resize"
                              class="fa fa-arrows-v form-control w2em border-none di"></span>
                            <input class="form-control w20em di"
                                   pr-validation-answer="data_validation:divisions[division_index]"
                                   placeholder="{{ _('Division name placeholder') }}"
                                   ng-model="division.name">
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 p025em">
                            <div class="dib border-none pull-right"
                                 pr-validation-answer="data_validation:remove_division[division_index]">
                                <select
                                        popover-trigger="none"
                                        pr-validation-answer="data_validation:remove_division[division_index]"
                                        class="form-control" ng-model="division.portal_division_type_id">
                                    <option ng-selected="division_type.id == division.portal_division_type_id"
                                            ng-repeat="(division_type_id, division_type) in data.division_types"
                                            value="{{ division_type_id }}">{{ ::_('option division type
                                        %(division_type)s',
                                        {'division_type': division_type.id}) }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 p025em">
                            <div class="dib border-none"
                                 pr-validation-answer="data_validation:company_subportal[division_index]"><select
                                    popover-trigger="none"
                                    pr-validation-answer="data_validation:company_subportal[division_index]"
                                    class="form-control" ng-if="division.portal_division_type_id == 'company_subportal'"
                                    ng-init="division.settings.company_id = data.portal_company_members[0].id"
                                    ng-model="division.settings.company_id" ng-options="member.id as member.name for member
                            in data.portal_company_members">
                            </select>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 p025em">
                            <button ng-click="removeDivision($index)" class="pull-right btn btn-warning form-control"><i
                                    class="fa fa-minus"></i> {{ ::_('remove division') }}
                            </button>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <hr/>
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p025em">

                        <button class="btn btn-primary pull-right border-radius w20em" type="button"
                                ng-click="$af.save(data)" ng-disabled="!$af.isActionAllowed(data, 'save') ">{{
                            ::_('Save new portal') }}
                        </button>
                    </div>
                </div>

            </div>

        </form>

    </div>
    {% endraw %}




    {#    <div ng-controller="portal_create">#}
    {#        <h2>{{_('Cteate portal')}}</h2>#}
    {##}
    {#        <div ng-click="chooseImage()"#}
    {#             style="float: left; width: 190px; height: 100px; border: 1px solid #aaa;#}
    {#                     background-position: center;#}
    {#                     background-repeat: no-repeat;#}
    {#                     background-color: white;#}
    {#                     background-size: contain; background-image:url({{ logo_file_url }});">#}
    {#            {{ _('Select portal logo') }}#}
    {#        </div>#}
    {##}
    {#        <div style="width: 800px; margin-left: 200px;">#}
    {#            <div class="item">#}
    {#                <span class="input_label">{{_('Portal name')}}:</span><input type="text"#}
    {#                                                                             placeholder="{{_('Portal name')}}"#}
    {#                                                                             ng-model-options="{updateOn : 'change keypress'}"#}
    {#                                                                             ng-model="data.portal.name">#}
    {#                <span af-validation-answer="data_validation:name"></span>#}
    {#            </div>#}
    {#            <div class="item">#}
    {#                        <span class="input_label">{{_('Portal host')}}: <span#}
    {#                                style="color: black">http://</span></span><input type="text"#}
    {#                                                                                 placeholder="{{_('Host name')}}"#}
    {#                                                                                 ng-model="data.portal.host">#}
    {#                <span af-validation-answer="data_validation:host"></span>#}
    {#            </div>#}
    {#            <div class="item">#}
    {#                <span class="input_label">{{_('Portal layout')}}:</span><select#}
    {#                    ng-model="data.portal.portal_layout_id"#}
    {#                    ng-options="layout.id as layout.name for layout in data.layouts"></select>#}
    {#            </div>#}
    {#        </div>#}
    {##}
    {##}
    {#        <h4>{{_('Portal divisions')}}</h4>#}
    {##}
    {#    <div class="item">#}
    {#        <input type="text" placeholder="" disabled="disabled"#}
    {#               value="{{ data.portal.name }}">#}
    {#        <select style="width: 150px" disabled="disabled">#}
    {#            <option>{{ _('index') }}</option>#}
    {#        </select>#}
    {##}
    {#    </div>#}
    {#    <div class="item" ng-if="division.portal_division_type_id != 'index'"#}
    {#         ng-repeat="(division_index, division) in data.portal.divisions">#}
    {#        <input type="text" placeholder="Division name" ng-model="division.name">#}
    {#        <select style="width: 150px" ng-model="division.portal_division_type_id">#}
    {#            <option ng-selected="division_type.id == division.portal_division_type_id"#}
    {#                    ng-if="division_type.id != 'index'"#}
    {#                    ng-repeat="(division_type_id, division_type) in data.division_types"#}
    {#                    value="{{ division_type_id }}">{{ division_type.id }}#}
    {#            </option>#}
    {#        </select>#}
    {#        <input type="number" placeholder="Articles per page" ng-model="division.page_size">#}
    {#        <select ng-if="division.portal_division_type_id == 'company_subportal'"#}
    {#                ng-model="division.settings.company_id">#}
    {#            <option ng-selected="portal_member_company.id == division.settings.company_id"#}
    {#                    ng-repeat="(portal_member_company_id, portal_member_company) in data.portal_company_members"#}
    {#                    value="{{ portal_member_company_id }}">{{ portal_member_company.name }}#}
    {#            </option>#}
    {#        </select>#}
    {#        <span af-validation-answer="data_validation:divisions[division_index]"></span>#}
    {#                    <span class="link error" style="float: right"#}
    {#                          ng-click="removeDivision($index)">X</span>#}
    {#    </div>#}
    {#    <div class="item">#}
    {#        <input type="text" style="visibility: hidden"/>#}
    {#        <button type="button" ng-click="addDivision()">{{ _('add division') }}</button>#}
    {#        <span af-validation-answer="data_validation:add_division"></span>#}
    {#    </div>#}
    {##}
    {##}
    {#    <div class="item text-align-right">#}
    {#        <span af-validation-answer="data_validation:form"></span>#}
    {#        <input#}
    {#                type="submit"#}
    {#                ng-disabled="!$af.isActionAllowed(data, 'save')"#}
    {#                ng-click="$af.save(data)"#}
    {#                value="{{ data.id ? _('save') : _('create') }}"/>#}
    {##}
    {##}
    {#    </div>#}
    {##}
    {#    </div>#}
    {#    </div>#}



{% endblock portal_content %}
